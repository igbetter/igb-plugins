(function(){if("function"!==typeof document.addEventListener||!Element.prototype.matches)return;var waiting,formCompleteHandler;waiting=0;document.addEventListener("click",handleClickEvents);document.addEventListener("scroll",handleScrollEvents);window.addEventListener("DOMContentLoaded",function(){if(window.jQuery)window.jQuery(document).on("frmFormComplete",handleFormComplete);document.addEventListener("frmFormCompleteBeforeReplace",handleFormCompleteBeforeReplace)});function handleFormComplete(){var paginationContainers=
document.querySelectorAll(".frm_pagination_cont");waiting=paginationContainers.length;each(paginationContainers,maybeRefreshView)}function handleFormCompleteBeforeReplace(event){var object,response,$replaceContent,$copy,originalContent;object=event.frmData.object;response=event.frmData.response;$replaceContent=jQuery(object).closest(".frm_forms");$copy=$replaceContent.clone();originalContent=response.content;$replaceContent.after($copy);response.content=jQuery(response.content).addClass("frm_hidden").prop("outerHTML");
formCompleteHandler=function(){$copy.replaceWith(originalContent)}}function finishedWaiting(){if(0===--waiting&&"function"===typeof formCompleteHandler)formCompleteHandler()}function maybeRefreshView(paginationContainer){var viewElements,comment,viewId;viewElements=[];comment=loopPreviousSiblingsUntilComment(paginationContainer,function(previousSibling){if(!nodeIsViewComment(previousSibling))viewElements.push(previousSibling)});if(false===comment){finishedWaiting();return}if("1"!==getRefreshFromComment(comment)){finishedWaiting();
return}viewId=getViewIdFromComment(comment);if(false===viewId){finishedWaiting();return}loadPage(viewId,getCurrentPageNumber(paginationContainer,viewId),comment,function(html){finishedWaiting();paginationContainer.insertAdjacentHTML("beforebegin",html);each(viewElements,maybeRemove);maybeRemove(paginationContainer)})}function getCurrentPageNumber(paginationContainer,viewId){var activeItem,link,href,split,params,pageNumber;activeItem=paginationContainer.querySelector(".active");if(!activeItem)return 1;
link=activeItem.querySelector("a");if(!link)return 1;href=link.getAttribute("href");split=href.split("?");if(split.length!==2)return 1;params=split[1].split("&");pageNumber=1;each(params,function(param){if(0===param.indexOf("frm-page-"+viewId+"=")){pageNumber=parseInt(param.replace("frm-page-"+viewId+"=",""));return false}});return pageNumber}function handleClickEvents(event){var target=event.target;if("A"!==target.nodeName||!getPaginationContainerFromChild(target))return;event.preventDefault();handlePageClick(target)}
function handlePageClick(target){var paginationContainer,href,hrefSplit,pageKey,viewId,viewElements,comment,page;paginationContainer=getPaginationContainerFromChild(target);if(!paginationContainer)return;if(hasClass(target,"frm-ajax-pagination-load-more")){loadInfiniteScroll(target);return}href=target.href;pageKey=false;hrefSplit=href.split("?");if(hrefSplit.length>=2)each(hrefSplit[1].split("&"),function(param){var split=param.split("=");if(0===split[0].indexOf("frm-page-")){pageKey=param;page=parseInt(split[1])}});
if(!pageKey)return;viewId=parseInt(pageKey.replace("frm-page-",""));viewElements=[];comment=loopPreviousSiblingsUntilComment(paginationContainer,function(previousSibling){if(!nodeIsViewComment(previousSibling))viewElements.push(previousSibling)});loadPage(viewId,page,comment,handlePageHtml);function handlePageHtml(html){if(viewElements.length){paginationContainer.insertAdjacentHTML("beforebegin",html);each(viewElements,maybeRemove)}maybeRemove(paginationContainer);setQueryStringParameter("frm-page-"+
viewId,page)}}function loopPreviousSiblingsUntilComment(element,handleSibling){var previousSibling,comment;previousSibling=element.previousSibling;comment=false;while(previousSibling){if("function"===typeof handleSibling&&false===handleSibling(previousSibling))break;comment=checkElementForComment(previousSibling);if(false!==comment)break;previousSibling=previousSibling.previousSibling}return comment}function checkParagraphForViewComment(p){var comment=false;each(p.childNodes,function(node){if(nodeIsViewComment(node)){comment=
node;return false}});return comment}function nodeListToArray(nodeList){var index,length,result;length=nodeList.length;result=[];for(index=0;index<length;++index)result.push(nodeList[index]);return result}function nodeIsViewComment(node){return node&&"#comment"===node.nodeName&&-1!==node.nodeValue.indexOf("FRM-VIEW")}function maybeRemove(element){if(element.parentNode)element.parentNode.removeChild(element)}function getPaginationContainerFromChild(child){return getClosestParent(child,".frm_ajax_pagination_cont")}
function handleScrollEvents(){var loadMoreButtons=document.getElementsByClassName("frm-ajax-pagination-load-more");if(!loadMoreButtons.length)return;each(loadMoreButtons,function(trigger){if(!hasClass(trigger,"frm-infinite-scroll")||trigger.getBoundingClientRect().bottom>window.innerHeight)return;loadInfiniteScroll(trigger)})}function loadPage(viewId,page,comment,callback){var url,xhr,params;url=frmViewsPaginationVars.ajaxurl+"?action=frm_views_load_page&frm-page-"+viewId+"="+page;xhr=new XMLHttpRequest;
xhr.open("post",url,true);xhr.onreadystatechange=handleReadyStateChange;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");params="id="+viewId;if(false!==comment)params+="&frm_view_page_state="+encodeURIComponent(getStateFromComment(comment));if("__FRMTABLES"in window&&undefined!==__FRMTABLES.graphs)params+="&frm_graph_offset="+__FRMTABLES.graphs.length;params+="&frm_modal_offset="+getModalOffset();xhr.send(params);function handleReadyStateChange(){var json,
tempContainer,newScripts,newGraphData;if(!requestIsSuccessful(xhr))return;json=JSON.parse(xhr.responseText);tempContainer=document.createElement("div");newScripts=[];tempContainer.innerHTML=json.html;each(tempContainer.querySelectorAll("script"),function(script){var newScript=document.createElement("script");newScript.innerHTML=script.innerHTML;maybeRemove(script);newScripts.push(newScript)});callback(tempContainer.innerHTML);if(undefined!==json.graphs){if("__FRMTABLES"in window){newGraphData=JSON.parse(JSON.stringify(window.__FRMTABLES));
if(undefined!==json.graphs.graphs)each(json.graphs.graphs,function(graph){newGraphData.graphs.push(graph)})}else newGraphData=json.graphs;__FRMTABLES=newGraphData;if("object"===typeof window.frmProForm)frmProForm.loadGoogle()}if("string"===typeof json.modal&&""!==json.modal)document.body.insertAdjacentHTML("beforeend",json.modal);each(newScripts,function(script){document.body.appendChild(script)})}}function getModalOffset(){var numberOfModals=0;while(document.getElementById("frm-modal-"+numberOfModals))++numberOfModals;
return numberOfModals}function setQueryStringParameter(name,value){if("function"!==typeof URLSearchParams)return;const params=new URLSearchParams(window.location.search);params.set(name,value);window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${params}`))}function getStateFromComment(comment){return getKeyValueFromComment(comment,"state")}function getRefreshFromComment(comment){return getKeyValueFromComment(comment,"refresh")}function getKeyValueFromComment(comment,
key){var text,substr,start,end;text=comment.nodeValue;substr=key+'="';start=text.indexOf(substr);if(-1===start)return"";start+=substr.length;end=text.indexOf('"',start+1);return text.substring(start,end)}function getViewIdFromComment(comment){var split=comment.nodeValue.split(" ");if(split.length>=3)return parseInt(split[2]);return false}function requestIsSuccessful(xhr){return xhr.readyState>3&&xhr.status==200&&xhr.responseText!==""}function loadInfiniteScroll(trigger){var viewId,page,paginationContainer,
comment;if(hasClass(trigger,"frm-loading-infinite-scroll"))return;viewId=parseInt(trigger.getAttribute("frm-view-id"));page=parseInt(trigger.getAttribute("frm-page"))+1;paginationContainer=getPaginationContainerFromChild(trigger);trigger.className+=" frm-loading-infinite-scroll";if(handleSpecialInfiniteScrollType(trigger,viewId,page,paginationContainer))return;comment=loopPreviousSiblingsUntilComment(paginationContainer);loadPage(viewId,page,comment,function(html){var wrapper,callback;wrapper=document.createElement("div");
wrapper.innerHTML=html;replaceTrigger(wrapper.querySelector(".frm-ajax-pagination-load-more"),trigger);callback=function(child){paginationContainer.parentNode.insertBefore(child,paginationContainer)};each(nodeListToArray(wrapper.childNodes),function(child){if(hasClass(child,"frm_pagination_cont")&&!child.children.length)return;callback(child)});if(!paginationContainer.children.length)maybeRemove(paginationContainer)})}function handleSpecialInfiniteScrollType(trigger,viewId,page,paginationContainer){var args=
{trigger:trigger,viewId:viewId,page:page,paginationContainer:paginationContainer};if(hasClass(trigger,"frm-table-type")){loadInfiniteScrollForTable(args);return true}if(hasClass(trigger,"frm-grid-type")){loadInfiniteScrollForGrid(args);return true}if(hasClass(trigger,"frm-container-type")){loadInfiniteScrollForContainer(args);return true}return false}function replaceTrigger(newTrigger,oldTrigger){if(newTrigger)oldTrigger.parentNode.insertBefore(newTrigger,oldTrigger);maybeRemove(oldTrigger)}function loadInfiniteScrollForTable(args){var table,
comment;table=checkBeforePaginationContainerForTable(args.paginationContainer);if(false===table)return;comment=checkForViewComment(table,args.paginationContainer);loadPage(args.viewId,args.page,comment,function(html){var wrapper,tbody;wrapper=createWrapperWithReplacedTrigger(html,args.trigger);tbody=table.querySelector("tbody");each(wrapper.querySelectorAll("tbody tr"),function(row){tbody.appendChild(row)})})}function checkForViewComment(element,paginationContainer){var comment=loopPreviousSiblingsUntilComment(element);
if(false===comment)comment=loopPreviousSiblingsUntilComment(paginationContainer);return comment}function createWrapperWithReplacedTrigger(html,trigger){var wrapper=document.createElement("div");wrapper.innerHTML=html;replaceTrigger(wrapper.querySelector(".frm-ajax-pagination-load-more"),trigger);return wrapper}function checkBeforePaginationContainerForTable(paginationContainer){return checkBeforePaginationContainerForElement(paginationContainer,function(element){return"TABLE"===element.nodeName},
"table.with_frm_style")}function checkBeforePaginationContainerForElement(paginationContainer,callback,fallbackSelector){var match=checkBeforePaginationContainerForMatch(paginationContainer,callback);if(false===match)match=checkBeforePaginationContainerForViewElement(paginationContainer,fallbackSelector);return match}function checkBeforePaginationContainerForViewElement(paginationContainer,selector){var element;if(!paginationContainer.previousElementSibling)return false;element=paginationContainer.previousElementSibling.querySelector(selector);
if(!element)return false;return element}function checkBeforePaginationContainerForGrid(paginationContainer){return checkBeforePaginationContainerForElement(paginationContainer,function(element){return hasClass(element,"frm-grid-view")},".frm-grid-view")}function checkBeforePaginationContainerForMatch(paginationContainer,callback){var match=false;loopPreviousSiblingsUntilComment(paginationContainer,function(previousSibling){if(callback(previousSibling)){match=previousSibling;return false}});return match}
function checkElementForComment(element){if(!element)return false;if("P"===element.nodeName)return checkParagraphForViewComment(element);if(nodeIsViewComment(element))return element;return false}function loadInfiniteScrollForGrid(args){var grid,comment;grid=checkBeforePaginationContainerForGrid(args.paginationContainer);if(false===grid)return;comment=checkForViewComment(grid,args.paginationContainer);loadPage(args.viewId,args.page,comment,function(html){var wrapper=createWrapperWithReplacedTrigger(html,
args.trigger);each(nodeListToArray(wrapper.querySelector(".frm-grid-view").children),function(row){grid.appendChild(row)})})}function loadInfiniteScrollForContainer(args){var container,comment;container=args.paginationContainer.previousElementSibling;comment=loopPreviousSiblingsUntilComment(container);loadPage(args.viewId,args.page,comment,function(html){var wrapper=createWrapperWithReplacedTrigger(html,args.trigger);each(nodeListToArray(wrapper.childNodes),function(child){if(!hasClass(child,"frm_pagination_cont"))container.appendChild(child)})})}
function hasClass(element,targetClass){var className=" "+element.className+" ";return-1!==className.indexOf(" "+targetClass+" ")}function getClosestParent(element,selector){var activeParent=element.parentNode;while(activeParent&&"function"===typeof activeParent.matches){if(activeParent.matches(selector))return activeParent;activeParent=activeParent.parentNode}return false}function each(items,callback){var index,length;length=items.length;for(index=0;index<length;index++)if(false===callback(items[index],
index))break}})();
