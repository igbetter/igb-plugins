!function(n,a,t,c){"use strict";var e,o,i,r,l,s;void 0!==c&&(e={copyURL:function(t){var e=n(t.target);t.preventDefault(),wcClearClipboard(),wcSetClipboard(e.attr("href"),e)},copyURLTip:function(t){n(t.target).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).trigger("focus")}},o=a.Model.extend({url:t,getSyncData:function(){return{}},sync:function(t,e,i){var t=(i=i||{}).action||t,o=i.data||{};return i.data=this.getSyncData(o,t),i.emulateJSON=!0,a.sync.call(this,"create",e,i)}}).extend({defaults:function(){return{id:0,name:"",url:"",xmlFile:{},csvFile:{}}},getSyncData:function(t,e){return _.defaults({action:"wc_instagram_"+e,catalog_id:this.get("id")},t)},delete:function(t){var e={action:"delete_product_catalog",data:{_wpnonce:c.nonce.delete}};this.destroy(_.extend({},e,t))},getFile:function(t){return this.get(t+"File")},setFile:function(t,e){return this.set(t+"File",_.extend({},this.getFile(t),e))},fileAction:function(t,i){var o=this;this.fetch({action:t+"_product_catalog_file",data:{format:i,_wpnonce:c.nonce.fileAction},wait:!0,success:function(t,e){e.success&&e.data.file&&o.setFile(i,e.data.file)}})}}),i=a.Collection.extend({model:o}),r=a.View.extend({events:{"click .wc-instagram-product-catalog-copy":"copyURL","aftercopy .wc-instagram-product-catalog-copy":"copyURLTip","click .wc-instagram-product-catalog-delete":"delete","click .wc-instagram-product-catalog-feed-xml":"feedModal","click .wc-instagram-product-catalog-feed-csv":"feedModal"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},delete:function(t){if(t.preventDefault(),!window.confirm(c.confirmDelete))return!1;this.model.delete({wait:!0})},feedModal:function(t){t.preventDefault(),new l({model:this.model,format:n(t.target).text().toLowerCase()})}}),l=n.WCBackboneModal.View.extend({refreshTimeout:!1,events:function(){return _.extend({},n.WCBackboneModal.View.prototype.events,{"click .request-update":"requestUpdate","click .cancel-update":"cancelUpdate","click .copy-url":"copyURL","aftercopy .copy-url":"copyURLTip"})},initialize:function(t){var e=this;this.format=t.format,t=this.getFile(),n.WCBackboneModal.View.prototype.initialize.apply(this,[{target:"wc-instagram-product-catalog-feed",string:{format:this.format,action:this.getActionForFile(t),catalog:this.model.toJSON(),file:t}}]),this.listenTo(this.model,"change:"+this.format+"File",function(){e._string.file=e.model.getFile(e.format),e._string.file.status&&(e.refreshTimeout=setTimeout(function(){e.fetchFile()},5e3)),e.setAction(e.getActionForFile(e._string.file)),e.render()})},render:function(){this.$el.empty(),n.WCBackboneModal.View.prototype.render.apply(this)},getFile:function(){var t=this.model.getFile(this.format);return _.isEmpty(t)&&this.fetchFile(),t},fetchFile:function(){this.model.fileAction("fetch",this.format)},getActionForFile:function(t){if(_.isEmpty(t))return"loading";switch(t.status){case"":return t.lastModified?"viewing":"creating";case"queued":case"processing":return"updating";default:return t.status}},setAction:function(t){this._string.action=t},doAction:function(t){clearTimeout(this.refreshTimeout),this.setAction(t),this.render()},requestUpdate:function(t){t.preventDefault(),this.doAction("updating"),this.model.fileAction("generate",this.format)},cancelUpdate:function(t){t.preventDefault(),this.doAction("canceling"),this.model.fileAction("cancel",this.format)}}),s=a.View.extend({initialize:function(){var o=this;this.collection=new i([],{comparator:!1}),this.$el.find("tbody tr").each(function(t,e){var i=o.extractCatalogModel(e);o.collection.add(i),new r({el:e,model:i})}),n(document.body).trigger("init_tooltips")},extractCatalogModel:function(t){var e=n(t).find("td.title > a"),i=new URLSearchParams(e.prop("href"));return new o({id:i.get("catalog_id"),name:e.text(),url:n(t).find(".wc-instagram-product-catalog-copy").prop("href")})}}),_.defaults(r.prototype,e),_.defaults(l.prototype,e),n(function(){new s({el:".product_catalogs"})}))}(jQuery,(wp,Backbone),ajaxurl,wc_instagram_product_catalogs_params);